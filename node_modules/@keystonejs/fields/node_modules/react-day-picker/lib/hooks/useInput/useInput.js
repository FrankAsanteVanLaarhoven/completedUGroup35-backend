import * as DateFns from 'date-fns';
import * as React from 'react';
import { defaultProps } from '../../components/DayPicker';
/**
 * @private
 */
function isValidDate(day) {
    return !isNaN(day.getTime());
}
/**
 * Return the props for binding an input field with DayPicker.
 *
 * **Example**
 *
 * ```jsx showOutput open=no
 * function Example() {
 *   const { dayPickerProps, inputProps } = useInput(new Date(), 'yyyy-MM-dd');
 *   return (
 *     <>
 *       <p>
 *         Type a day or pick one from the calendar:
 *         <input {...inputProps} placeholder="YYYY-MM-DD" />
 *       </p>
 *       <DayPicker {...dayPickerProps} />
 *     </>
 *   );
 * }
 * ```
 */
export function useInput(initialDay, formatStr, options) {
    var _a, _b;
    // Defaults from options
    var locale = (_a = options === null || options === void 0 ? void 0 : options.locale) !== null && _a !== void 0 ? _a : defaultProps.locale;
    var required = (_b = options === null || options === void 0 ? void 0 : options.required) !== null && _b !== void 0 ? _b : false;
    // Shortcut to the DateFns functions
    var format = function (day) { return DateFns.format(day, formatStr, { locale: locale }); };
    var parse = function (value) {
        return DateFns.parse(value, formatStr, new Date(), { locale: locale });
    };
    // The initial value of the input field
    var initialValue = initialDay ? format(initialDay) : '';
    // Initialize state
    var _c = React.useState(initialDay), selected = _c[0], setSelected = _c[1];
    var _d = React.useState(initialValue), value = _d[0], setValue = _d[1];
    var _e = React.useState(initialDay !== null && initialDay !== void 0 ? initialDay : defaultProps.month), month = _e[0], setMonth = _e[1];
    var onDayClick = function (day) {
        setSelected(day);
        setValue(format(day));
    };
    var onMonthChange = function (month) {
        setMonth(month);
    };
    // When changing the input field, save its value in state and check if the
    // string is a valid date. If it is a valid day, set it as selected and update
    // the calendarâ€™s month.
    var onChange = function (e) {
        setValue(e.target.value);
        var day = parse(e.target.value);
        if (!isValidDate(day)) {
            setSelected(undefined);
            return;
        }
        setSelected(day);
        setMonth(day);
    };
    // Special case for _required_ fields: on blur, if the value of the input is not
    // a valid date, reset the calendar and the input value.
    var onBlur = function (e) {
        var _a;
        var day = parse(e.target.value);
        if ((_a = !required) !== null && _a !== void 0 ? _a : isValidDate(day)) {
            return;
        }
        setSelected(initialDay);
        setMonth(initialDay !== null && initialDay !== void 0 ? initialDay : defaultProps.month);
        setValue(initialValue !== null && initialValue !== void 0 ? initialValue : '');
    };
    // When focusing, make sure DayPicker visualize the month of the date in the
    // input field.
    var onFocus = function (e) {
        if (e.target.value) {
            var day = parse(e.target.value);
            if (isValidDate(day)) {
                setMonth(day);
            }
            return;
        }
        setSelected(initialDay);
        setMonth(initialDay !== null && initialDay !== void 0 ? initialDay : defaultProps.month);
        setValue(initialValue !== null && initialValue !== void 0 ? initialValue : '');
    };
    return {
        setMonth: setMonth,
        setValue: setValue,
        dayPickerProps: {
            month: month,
            selected: selected,
            onDayClick: onDayClick,
            onMonthChange: onMonthChange
        },
        inputProps: {
            value: value,
            onChange: onChange,
            onFocus: onFocus,
            onBlur: onBlur
        }
    };
}
//# sourceMappingURL=useInput.js.map